import axios, { AxiosError } from 'axios';

// 1. Definição de Constantes
// Evita repetição e facilita a alteração da URL base.
const BASE_URL: string = process.env.BACKEND_URL || 'http://192.168.3.112:8000';
const USER_ME_ENDPOINT: string = '/api/usuarios/me';

// 2. Função Assíncrona para Encapsulamento e Reutilização
// Assume que 'User' é uma interface/tipo definido em outro lugar.
async function fetchCurrentUser(token: string): Promise<User | null> {
    const url: string = `${BASE_URL}${USER_ME_ENDPOINT}`;

    try {
        // 3. Tipagem no axios.get e desestruturação de 'data'
        const { data } = await axios.get<User>(url, {
            headers: {
                Authorization: `Bearer ${token}`,
                // Boas práticas: Adicionar Content-Type, mesmo que não seja necessário para GET
                'Content-Type': 'application/json',
            },
        });
        
        // Retorna o objeto User
        return data;

    } catch (error) {
        // 4. Tratamento de Erro (Essencial)
        if (axios.isAxiosError(error)) {
            const axiosError = error as AxiosError;
            console.error('Erro na chamada da API:', axiosError.response?.data || axiosError.message);
            
            // Você pode lançar o erro novamente ou retornar um valor seguro (null)
            // throw new Error('Falha ao buscar dados do usuário.');
            return null; 
        } else {
            console.error('Erro inesperado:', error);
            return null;
        }
    }
}

